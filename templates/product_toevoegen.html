{% extends "base.html" %}

{% block title %}Product toevoegen{% endblock %}

{% block content %}
<div class="bg-white p-8 rounded-lg shadow-md max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold text-gray-800 mb-6">Product toevoegen</h1>

    <form method="POST" enctype="multipart/form-data" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label for="naam" class="block text-sm font-medium text-gray-700 mb-1">Naam*</label>
                <input type="text" id="naam" name="naam" required
                       class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
            </div>

            <div>
                <label for="prijs" class="block text-sm font-medium text-gray-700 mb-1">Prijs*</label>
                <input type="number" id="prijs" name="prijs" step="0.01" min="0" required
                       class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
            </div>
        </div>

        <div>
            <label for="categorie_id" class="block text-sm font-medium text-gray-700 mb-1">Categorie*</label>
            <select id="categorie_id" name="categorie_id" required
                    class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                <option value="">Selecteer een categorie</option>
                {% for categorie in categorieen %}
                <option value="{{ categorie.id }}">{{ categorie.naam }}</option>
                {% endfor %}
            </select>
        </div>

        <div>
            <label for="beschrijving" class="block text-sm font-medium text-gray-700 mb-1">Beschrijving*</label>
            <textarea id="beschrijving" name="beschrijving" rows="4" required
                      class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"></textarea>
        </div>

        <div id="kleurvarianten-container">
            <div class="flex justify-between items-center mb-2">
                <h3 class="text-lg font-medium text-gray-700">Kleurvarianten</h3>
                <button type="button" id="voeg-kleur-toe" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                    + Voeg kleur toe
                </button>
            </div>

            <div id="kleurvariant-0"
                 class="kleurvariant grid grid-cols-1 md:grid-cols-3 gap-6 mb-6 p-4 bg-gray-50 rounded-md">
                <div>
                    <label for="kleur_naam_0" class="block text-sm font-medium text-gray-700 mb-1">Kleur naam*</label>
                    <input type="text" id="kleur_naam_0" name="kleur_naam[]" required
                           class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="kleur_foto_0" class="block text-sm font-medium text-gray-700 mb-1">Kleur foto*</label>
                    <input type="file" id="kleur_foto_0" name="kleur_foto[]" accept="image/*" required
                           class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                </div>
                <div>
                    <label for="kleur_hover_foto_0" class="block text-sm font-medium text-gray-700 mb-1">Hover
                        foto*</label>
                    <input type="file" id="kleur_hover_foto_0" name="kleur_hover_foto[]" accept="image/*" required
                           class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                </div>
            </div>

            <div id="kleur-template"
                 class="hidden kleurvariant grid grid-cols-1 md:grid-cols-3 gap-6 mb-6 p-4 bg-gray-50 rounded-md">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Kleur naam*</label>
                    <input type="text" name="kleur_naam[]"
                           class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Kleur foto*</label>
                    <input type="file" name="kleur_foto[]" accept="image/*"
                           class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Hover foto*</label>
                    <input type="file" name="kleur_hover_foto[]" accept="image/*"
                           class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                </div>
                <button type="button"
                        class="verwijder-kleur text-red-600 hover:text-red-800 text-sm font-medium col-span-3 text-right">
                    Verwijder deze kleur
                </button>
            </div>
        </div>

        <div class="flex justify-end space-x-4 pt-4">
            <a href="{{ url_for('home') }}"
               class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                Annuleren
            </a>
            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                Product toevoegen
            </button>
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        let kleurIndex = document.querySelectorAll('.kleurvariant').length;

        document.getElementById('voeg-kleur-toe').addEventListener('click', function () {
            const template = document.getElementById('kleur-template');
            const newKleur = template.cloneNode(true);
            newKleur.classList.remove('hidden');
            newKleur.removeAttribute('id');
            newKleur.setAttribute('id', `kleurvariant-${kleurIndex}`);

            newKleur.querySelectorAll('input').forEach(input => {
                const newId = `${input.name.replace('[]', '')}_${kleurIndex}`;
                input.setAttribute('id', newId);
                const label = newKleur.querySelector(`label[for="${input.name.replace('[]', '')}"]`);
                if (label) {
                    label.setAttribute('for', newId);
                }
                // Zet required attribuut voor alle inputs behalve de verwijderknop
                if (input.type !== 'button') {
                    input.required = true;
                }
            });

            newKleur.querySelector('.verwijder-kleur').addEventListener('click', function () {
                newKleur.remove();
                // Update index na verwijdering
                kleurIndex = document.querySelectorAll('.kleurvariant').length;
            });

            document.getElementById('kleurvarianten-container').appendChild(newKleur);
            kleurIndex++;
        });

        document.querySelectorAll('.verwijder-kleur').forEach(button => {
            button.addEventListener('click', function () {
                this.closest('.kleurvariant').remove();
                // Update index na verwijdering
                kleurIndex = document.querySelectorAll('.kleurvariant').length;
            });
        });

        // Voeg een event listener toe voor het formulier
        document.querySelector('form').addEventListener('submit', function (e) {
            const kleurVarianten = document.querySelectorAll('.kleurvariant');
            let heeftGeldigeVarianten = false;

            kleurVarianten.forEach(variant => {
                const naam = variant.querySelector('input[name="kleur_naam[]"]').value;
                const foto = variant.querySelector('input[name="kleur_foto[]"]').files[0];
                const hoverFoto = variant.querySelector('input[name="kleur_hover_foto[]"]').files[0];

                if (naam.trim() && foto && hoverFoto) {
                    heeftGeldigeVarianten = true;
                }
            });

            if (!heeftGeldigeVarianten) {
                e.preventDefault();
                alert('Vul ten minste één volledige kleurvariant in.');
            }
        });
    });
</script>
{% endblock %}