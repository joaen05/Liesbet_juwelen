{% extends "base.html" %}

{% block title %}Ketting bewerken{% endblock %}

{% block content %}
<div class="bg-white p-8 rounded-lg shadow-md max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold text-gray-800 mb-6">Ketting bewerken</h1>

    <form method="POST" enctype="multipart/form-data" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label for="naam" class="block text-sm font-medium text-gray-700 mb-1">Naam*</label>
                <input type="text" id="naam" name="naam" required
                       value="{{ ketting.naam or '' }}"
                       class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
            </div>

            <div>
                <label for="prijs" class="block text-sm font-medium text-gray-700 mb-1">Prijs*</label>
                <input type="number" id="prijs" name="prijs" step="0.01" min="0" required
                       value="{{ "%.2f"|format(ketting.prijs) }}"
                       class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
            </div>
        </div>

        <div>
            <label for="beschrijving" class="block text-sm font-medium text-gray-700 mb-1">Beschrijving*</label>
            <textarea id="beschrijving" name="beschrijving" rows="4" required
                      class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">{{ ketting.beschrijving or '' }}</textarea>
        </div>

        <div id="kleurvarianten-container">
            <div class="flex justify-between items-center mb-2">
                <h3 class="text-lg font-medium text-gray-700">Kleurvarianten</h3>
                <button type="button" id="voeg-kleur-toe" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                    + Voeg kleur toe
                </button>
            </div>

            {% for kleur in kleuren %}
            <div id="kleurvariant-{{ loop.index0 }}" class="kleurvariant grid grid-cols-1 md:grid-cols-3 gap-6 mb-6 p-4 bg-gray-50 rounded-md">
                <div>
                    <label for="kleur_naam_{{ loop.index0 }}" class="block text-sm font-medium text-gray-700 mb-1">Kleur naam*</label>
                    <input type="text" id="kleur_naam_{{ loop.index0 }}" name="kleur_naam[]" required
                           value="{{ kleur.kleur_naam }}"
                           class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="kleur_foto_{{ loop.index0 }}" class="block text-sm font-medium text-gray-700 mb-1">Kleur foto*</label>
                    <input type="file" id="kleur_foto_{{ loop.index0 }}" name="kleur_foto[]" accept="image/*"
                           class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                    <p class="text-xs text-gray-500 mt-1">Huidig bestand: {{ kleur.foto }}</p>
                    <input type="hidden" name="oude_foto_{{ loop.index0 }}" value="{{ kleur.foto }}">
                </div>
                <div>
                    <label for="kleur_hover_foto_{{ loop.index0 }}" class="block text-sm font-medium text-gray-700 mb-1">Hover foto*</label>
                    <input type="file" id="kleur_hover_foto_{{ loop.index0 }}" name="kleur_hover_foto[]" accept="image/*"
                           class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                    <p class="text-xs text-gray-500 mt-1">Huidig bestand: {{ kleur.hover_foto }}</p>
                    <input type="hidden" name="oude_hover_foto_{{ loop.index0 }}" value="{{ kleur.hover_foto }}">
                </div>
                <button type="button" class="verwijder-kleur text-red-600 hover:text-red-800 text-sm font-medium col-span-3 text-right">
                    Verwijder deze kleur
                </button>
            </div>
            {% endfor %}

            <div id="kleur-template" class="hidden kleurvariant grid grid-cols-1 md:grid-cols-3 gap-6 mb-6 p-4 bg-gray-50 rounded-md">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Kleur naam*</label>
                    <input type="text" name="kleur_naam[]"
                           class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Kleur foto*</label>
                    <input type="file" name="kleur_foto[]" accept="image/*"
                           class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Hover foto*</label>
                    <input type="file" name="kleur_hover_foto[]" accept="image/*"
                           class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                </div>
                <button type="button" class="verwijder-kleur text-red-600 hover:text-red-800 text-sm font-medium col-span-3 text-right">
                    Verwijder deze kleur
                </button>
            </div>
        </div>

        <div class="flex justify-end space-x-4 pt-4">
            <a href="{{ url_for('kettingen') }}" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                Annuleren
            </a>
            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                Ketting bijwerken
            </button>
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        let kleurIndex = document.querySelectorAll('.kleurvariant').length;

        document.getElementById('voeg-kleur-toe').addEventListener('click', function() {
            const template = document.getElementById('kleur-template');
            const newKleur = template.cloneNode(true);
            newKleur.classList.remove('hidden');
            newKleur.removeAttribute('id');
            newKleur.setAttribute('id', `kleurvariant-${kleurIndex}`);

            newKleur.querySelectorAll('input').forEach(input => {
                const newId = `${input.name.replace('[]', '')}_${kleurIndex}`;
                input.setAttribute('id', newId);
                const label = newKleur.querySelector(`label[for="${input.name.replace('[]', '')}"]`);
                if (label) {
                     label.setAttribute('for', newId);
                }
            });

            newKleur.querySelector('.verwijder-kleur').addEventListener('click', function() {
                newKleur.remove();
            });

            document.getElementById('kleurvarianten-container').appendChild(newKleur);
            kleurIndex++;
        });

        document.querySelectorAll('.verwijder-kleur').forEach(button => {
            button.addEventListener('click', function() {
                this.closest('.kleurvariant').remove();
            });
        });
    });
</script>
{% endblock %}