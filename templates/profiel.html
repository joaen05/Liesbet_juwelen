{% extends "base.html" %}

{% block title %}Profiel bewerken{% endblock %}

{% block content %}
<div class="bg-white p-8 rounded-lg shadow-md max-w-2xl mx-auto">
    <h1 class="text-3xl font-bold text-gray-800 mb-6">Profiel bewerken</h1>

    <div id="message-box" class="hidden mb-4 p-3 rounded-lg text-sm transition-all duration-300"></div>

    <form id="gebruikersnaam-form" method="POST" action="/profiel/gebruikersnaam/bewerken" class="space-y-6">
        <div>
            <label for="gebruikersnaam" class="block text-sm font-medium text-gray-700 mb-1">Gebruikersnaam</label>
            <div class="flex items-center">
                <input type="text" id="gebruikersnaam" name="gebruikersnaam" value="{{ session['gebruikersnaam'] }}"
                       class="flex-1 px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500" readonly>
                <button type="button" onclick="enableEdit('gebruikersnaam')"
                        class="ml-2 p-2 text-blue-600 hover:text-blue-800">
                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                         xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                </button>
                <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 ml-2">Opslaan</button>
            </div>
        </div>
    </form>

    <div class="pt-4 border-t border-gray-200 mt-6">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">Wachtwoord wijzigen</h2>
    </div>

    <form id="wachtwoord-form" method="POST" action="/profiel/wachtwoord/bewerken" class="space-y-4">
        <div>
            <label for="oud_wachtwoord" class="block text-sm font-medium text-gray-700 mb-1">Oud wachtwoord</label>
            <input type="password" id="oud_wachtwoord" name="oud_wachtwoord"
                   class="w-full px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500">
        </div>

        <div>
            <label for="nieuw_wachtwoord" class="block text-sm font-medium text-gray-700 mb-1">Nieuw wachtwoord</label>
            <input type="password" id="nieuw_wachtwoord" name="nieuw_wachtwoord"
                   class="w-full px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500">
        </div>

        <div>
            <label for="bevestig_wachtwoord" class="block text-sm font-medium text-gray-700 mb-1">Bevestig nieuw wachtwoord</label>
            <input type="password" id="bevestig_wachtwoord" name="bevestig_wachtwoord"
                   class="w-full px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500">
        </div>

        <div class="flex justify-end">
            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Opslaan</button>
        </div>
    </form>
</div>

<script>
    function enableEdit(fieldId) {
        const field = document.getElementById(fieldId);
        field.removeAttribute('readonly');
        field.focus();
    }

    // Luister naar de form submission events en toon de messagebox
    document.getElementById('gebruikersnaam-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const form = e.target;
        const formData = new FormData(form);

        fetch(form.action, {
            method: 'POST',
            body: formData,
        })
        .then(response => response.json())
        .then(data => {
            showMessage(data.message, data.category);
            if (data.category === 'success') {
                document.getElementById('gebruikersnaam').value = data.new_username;
            }
        })
        .catch(error => console.error('Error:', error));
    });

    document.getElementById('wachtwoord-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const form = e.target;
        const formData = new FormData(form);

        fetch(form.action, {
            method: 'POST',
            body: formData,
        })
        .then(response => response.json())
        .then(data => {
            showMessage(data.message, data.category);
            if (data.category === 'success') {
                // Velden legen na succesvolle wachtwoordwijziging
                document.getElementById('oud_wachtwoord').value = '';
                document.getElementById('nieuw_wachtwoord').value = '';
                document.getElementById('bevestig_wachtwoord').value = '';
            }
        })
        .catch(error => console.error('Error:', error));
    });

    function showMessage(message, category) {
        const msgBox = document.getElementById('message-box');
        msgBox.textContent = message;
        msgBox.className = 'mb-4 p-3 rounded-lg text-sm transition-all duration-300'; // Reset classes

        if (category === 'success') {
            msgBox.classList.add('bg-green-100', 'text-green-700', 'block');
        } else if (category === 'error') {
            msgBox.classList.add('bg-red-100', 'text-red-700', 'block');
        } else {
            msgBox.classList.add('bg-blue-100', 'text-blue-700', 'block');
        }

        // Verberg de box na 5 seconden
        setTimeout(() => {
            msgBox.classList.remove('block');
            msgBox.classList.add('hidden');
        }, 5000);
    }
</script>
{% endblock %}