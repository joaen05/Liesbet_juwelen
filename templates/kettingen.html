{% extends "base.html" %}

{% block title %}Kettingen{% endblock %}

{% block content %}
<div class="bg-white p-8 rounded-lg shadow-md">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-800">Kettingen</h1>
        {% if 'ingelogd' in session and session['ingelogd'] %}
        <a href="{{ url_for('ketting_toevoegen') }}" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition-colors duration-200">
            Ketting toevoegen
        </a>
        {% endif %}
    </div>

    {% if kettingen %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for ketting in kettingen %}
        <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300">
            <a href="{{ url_for('ketting_detail', ketting_id=ketting.id) }}">
                <div class="relative group aspect-square">
                    <img src="{{ url_for('static', filename='uploads/' + ketting.kleuren[0].foto) }}"
                         alt="{{ ketting.naam }}"
                         class="hoofd-foto absolute inset-0 w-full h-full object-cover transition-opacity duration-300 group-hover:opacity-0">
                    <img src="{{ url_for('static', filename='uploads/' + ketting.kleuren[0].hover_foto) }}"
                         alt="{{ ketting.naam }}"
                         class="hover-foto absolute inset-0 w-full h-full object-cover opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                </div>
            </a>

            <div class="p-4">
                <h3 class="text-xl font-semibold text-gray-800 mb-2">{{ ketting.naam }}</h3>
                <p class="text-gray-600 mb-3">{{ ketting.beschrijving[:100] }}{% if ketting.beschrijving|length > 100 %}...{% endif %}</p>

                {% if ketting.kleuren|length > 0 %}
                <div class="mb-3 flex items-center space-x-2">
                    <span class="text-sm font-medium text-gray-700">Kleur:</span>
                    <select id="kleur-select-{{ ketting.id }}"
                            class="kleur-selector p-1 text-sm border border-gray-300 rounded-md"
                            data-ketting-id="{{ ketting.id }}">
                        {% for kleur in ketting.kleuren %}
                        <option value="{{ loop.index0 }}"
                                data-foto="{{ kleur.foto }}"
                                data-hover-foto="{{ kleur.hover_foto }}">
                            {{ kleur.kleur_naam }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                {% endif %}

                <div class="flex justify-between items-center">
                    <span class="text-lg font-bold text-blue-600">â‚¬{{ "%.2f"|format(ketting.prijs) }}</span>
                    <div class="flex space-x-2">
                        {% if 'ingelogd' in session and session['ingelogd'] %}
                        <a href="{{ url_for('ketting_bewerken', ketting_id=ketting.id) }}" class="text-green-600 hover:text-green-800 font-medium">Bewerken</a>
                        <form action="{{ url_for('ketting_verwijderen', ketting_id=ketting.id) }}" method="POST" onsubmit="return confirm('Weet je zeker dat je deze ketting wilt verwijderen?');">
                            <button type="submit" class="text-red-600 hover:text-red-800 font-medium">Verwijderen</button>
                        </form>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p class="text-center text-gray-500 py-8">Geen kettingen gevonden.</p>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.kleur-selector').forEach(select => {
        select.addEventListener('change', function() {
            const option = this.options[this.selectedIndex];
            const kettingCard = this.closest('.bg-white.rounded-lg');
            const mainImg = kettingCard.querySelector('.hoofd-foto');
            const hoverImg = kettingCard.querySelector('.hover-foto');

            // Correcte manier om de URL's te bouwen
            const staticPath = '{{ url_for("static", filename="uploads/") }}';
            mainImg.src = staticPath + option.dataset.foto;
            hoverImg.src = staticPath + option.dataset.hoverFoto;
        });
    });
});
</script>
{% endblock %}